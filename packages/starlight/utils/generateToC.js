import { PAGE_TITLE_ID } from '../constants.js';

/** Convert the flat headings array generated by Astro into a nested tree structure. */
export function generateToC(headings, { minHeadingLevel, maxHeadingLevel, title }) {
	headings = headings.filter(({ depth }) => depth >= minHeadingLevel && depth <= maxHeadingLevel);
	const toc = [{ depth: 2, slug: PAGE_TITLE_ID, text: title, children: [] }];
	for (const heading of headings) injectChild(toc, { ...heading, children: [] });
	return toc;
}

/** Inject a ToC entry as deep in the tree as its `depth` property requires. */
function injectChild(items, item) {
	const lastItem = items.at(-1);
	if (!lastItem || lastItem.depth >= item.depth) {
		items.push(item);
	} else {
		return injectChild(lastItem.children, item);
	}
}
